<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kaivalya Dabhadkar">
<meta name="dcterms.date" content="2025-09-05">

<title>A Rigorous Deep Dive into a Power-Basis Cubic VAE – KD’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-9346ad716792c6ea4a70ecb1c093ba3a.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8a9848f8d79b2d254ead83ae78069bc9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="format-detection" content="telephone=no">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams'
    },
    options: {
      processHtmlClass: 'tex2jax_process|mathjax_process|math|output',
      enableExplorer: false
    },
    svg: {
      fontCache: 'global',
      scale: 1,
      minScale: 0.5,
      mtextInheritFont: false,
      merrorInheritFont: true,
      mathmlSpacing: false,
      skipAttributes: {},
      exFactor: 0.5,
      displayAlign: 'center',
      displayIndent: '0'
    }
  };
</script>
<script>
  // Attach original TeX to MathJax containers and ensure copy-to-clipboard includes TeX
  document.addEventListener('DOMContentLoaded', function () {
    if (window.MathJax && MathJax.startup && MathJax.startup.promise) {
      MathJax.startup.promise.then(function () {
        try {
          var items = MathJax.startup.document.getMathItemsWithin(document.body);
          items.forEach(function (item) {
            var tex = item.math;
            var container = item.typesetRoot; // <mjx-container>
            if (container && tex) {
              container.setAttribute('data-tex', tex);
              var isDisplay = container.getAttribute('display') === 'true';
              container.setAttribute('data-tex-wrapper', isDisplay ? '$$' : '$');
            }
          });
        } catch (e) { /* no-op */ }
      });
    }

    document.addEventListener('copy', function (e) {
      var sel = window.getSelection();
      if (!sel || sel.rangeCount === 0) { return; }
      var range = sel.getRangeAt(0);
      var fragment = range.cloneContents();
      var tmp = document.createElement('div');
      tmp.appendChild(fragment);
      var mjx = tmp.querySelectorAll('mjx-container');
      if (!mjx.length) { return; } // fall back to default behavior
      mjx.forEach(function (node) {
        var tex = node.getAttribute('data-tex');
        var wrap = node.getAttribute('data-tex-wrapper') || '$';
        var replacement = document.createTextNode(tex ? (wrap + tex + wrap) : (node.innerText || ''));
        node.parentNode.replaceChild(replacement, node);
      });
      var text = tmp.innerText;
      e.clipboardData.setData('text/plain', text);
      e.preventDefault();
    });
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">KD’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Kaivalya1997"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kaivalya-dabhadkar-384a47151"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Rigorous Deep Dive into a Power-Basis Cubic VAE</h1>
            <p class="subtitle lead">From First Principles to a VAE Implementation: The Surprising Complexity of a Simple Idea</p>
                                <div class="quarto-categories">
                <div class="quarto-category">AI</div>
                <div class="quarto-category">Deep Learning</div>
                <div class="quarto-category">Variational Inference</div>
                <div class="quarto-category">Generative Models</div>
                <div class="quarto-category">Mathematics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kaivalya Dabhadkar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 5, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-premise-seeking-a-simpler-more-flexible-latent-space" id="toc-the-premise-seeking-a-simpler-more-flexible-latent-space" class="nav-link active" data-scroll-target="#the-premise-seeking-a-simpler-more-flexible-latent-space">1. The Premise: Seeking a Simpler, More Flexible Latent Space</a>
  <ul class="collapse">
  <li><a href="#interactive-vae-visualization" id="toc-interactive-vae-visualization" class="nav-link" data-scroll-target="#interactive-vae-visualization">Interactive VAE Visualization</a></li>
  <li><a href="#the-reign-of-the-gaussian-vae" id="toc-the-reign-of-the-gaussian-vae" class="nav-link" data-scroll-target="#the-reign-of-the-gaussian-vae">1.1. The Reign of the Gaussian VAE</a></li>
  <li><a href="#the-quest-for-a-simple-alternative-the-cubic-polynomial" id="toc-the-quest-for-a-simple-alternative-the-cubic-polynomial" class="nav-link" data-scroll-target="#the-quest-for-a-simple-alternative-the-cubic-polynomial">1.2. The Quest for a Simple Alternative: The Cubic Polynomial</a></li>
  </ul></li>
  <li><a href="#the-labyrinth-of-constraints-deriving-a-power-basis-cubic-pdf" id="toc-the-labyrinth-of-constraints-deriving-a-power-basis-cubic-pdf" class="nav-link" data-scroll-target="#the-labyrinth-of-constraints-deriving-a-power-basis-cubic-pdf">2. The Labyrinth of Constraints: Deriving a Power-Basis Cubic PDF</a>
  <ul class="collapse">
  <li><a href="#the-normalization-constraint-a-first-simplification" id="toc-the-normalization-constraint-a-first-simplification" class="nav-link" data-scroll-target="#the-normalization-constraint-a-first-simplification">2.1. The Normalization Constraint: A First Simplification</a></li>
  <li><a href="#the-non-negativity-constraint-the-true-challenge" id="toc-the-non-negativity-constraint-the-true-challenge" class="nav-link" data-scroll-target="#the-non-negativity-constraint-the-true-challenge">2.2. The Non-Negativity Constraint: The True Challenge</a></li>
  <li><a href="#conclusion-the-impracticality-of-the-power-basis" id="toc-conclusion-the-impracticality-of-the-power-basis" class="nav-link" data-scroll-target="#conclusion-the-impracticality-of-the-power-basis">2.3. Conclusion: The Impracticality of the Power Basis</a></li>
  </ul></li>
  <li><a href="#a-constructive-solution-the-bernstein-basis" id="toc-a-constructive-solution-the-bernstein-basis" class="nav-link" data-scroll-target="#a-constructive-solution-the-bernstein-basis">3. A Constructive Solution: The Bernstein Basis</a>
  <ul class="collapse">
  <li><a href="#normalization-of-the-bernstein-cubic" id="toc-normalization-of-the-bernstein-cubic" class="nav-link" data-scroll-target="#normalization-of-the-bernstein-cubic">3.1. Normalization of the Bernstein-Cubic</a></li>
  <li><a href="#cdf-sampling-and-gradients" id="toc-cdf-sampling-and-gradients" class="nav-link" data-scroll-target="#cdf-sampling-and-gradients">3.2. CDF, Sampling, and Gradients</a></li>
  </ul></li>
  <li><a href="#the-vae-framework-with-a-bernstein-cubic-latent" id="toc-the-vae-framework-with-a-bernstein-cubic-latent" class="nav-link" data-scroll-target="#the-vae-framework-with-a-bernstein-cubic-latent">4. The VAE Framework with a Bernstein-Cubic Latent</a>
  <ul class="collapse">
  <li><a href="#the-elbo-in-full-detail" id="toc-the-elbo-in-full-detail" class="nav-link" data-scroll-target="#the-elbo-in-full-detail">4.1. The ELBO in Full Detail</a></li>
  <li><a href="#elbo-step-by-step-derivation-and-per-dimension-form" id="toc-elbo-step-by-step-derivation-and-per-dimension-form" class="nav-link" data-scroll-target="#elbo-step-by-step-derivation-and-per-dimension-form">4.2. ELBO: Step-by-step derivation and per-dimension form</a></li>
  </ul></li>
  <li><a href="#pytorch-implementation" id="toc-pytorch-implementation" class="nav-link" data-scroll-target="#pytorch-implementation">5. PyTorch Implementation</a></li>
  <li><a href="#conclusion-from-a-simple-idea-to-a-rigorous-solution" id="toc-conclusion-from-a-simple-idea-to-a-rigorous-solution" class="nav-link" data-scroll-target="#conclusion-from-a-simple-idea-to-a-rigorous-solution">6. Conclusion: From a Simple Idea to a Rigorous Solution</a></li>
  <li><a href="#further-reading-beyond-simple-posteriors" id="toc-further-reading-beyond-simple-posteriors" class="nav-link" data-scroll-target="#further-reading-beyond-simple-posteriors">7. Further Reading: Beyond Simple Posteriors</a>
  <ul class="collapse">
  <li><a href="#normalizing-flows" id="toc-normalizing-flows" class="nav-link" data-scroll-target="#normalizing-flows">Normalizing Flows</a></li>
  <li><a href="#mixture-models-and-hierarchical-methods" id="toc-mixture-models-and-hierarchical-methods" class="nav-link" data-scroll-target="#mixture-models-and-hierarchical-methods">Mixture Models and Hierarchical Methods</a></li>
  <li><a href="#alternative-objectives-and-formulations" id="toc-alternative-objectives-and-formulations" class="nav-link" data-scroll-target="#alternative-objectives-and-formulations">Alternative Objectives and Formulations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="the-premise-seeking-a-simpler-more-flexible-latent-space" class="level2">
<h2 class="anchored" data-anchor-id="the-premise-seeking-a-simpler-more-flexible-latent-space">1. The Premise: Seeking a Simpler, More Flexible Latent Space</h2>
<section id="interactive-vae-visualization" class="level3">
<h3 class="anchored" data-anchor-id="interactive-vae-visualization">Interactive VAE Visualization</h3>
<div class="cell">
<details class="code-fold hidden">
<summary>Show code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="28" data-source-offset="-29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 27;"><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the comprehensive VAE visualization</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">850</span><span class="op">;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">480</span><span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin"</span><span class="op">,</span> <span class="st">"20px auto"</span>)<span class="op">;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"box-shadow"</span><span class="op">,</span> <span class="st">"0 10px 30px rgba(0,0,0,0.2)"</span>)<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add gradient definitions</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background gradient</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bgGradient <span class="op">=</span> defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"linearGradient"</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"bg-gradient"</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="st">"0%"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="st">"0%"</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  bgGradient<span class="op">.</span><span class="fu">append</span>(<span class="st">"stop"</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"offset"</span><span class="op">,</span> <span class="st">"0%"</span>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stop-color"</span><span class="op">,</span> <span class="st">"#1e3c72"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stop-opacity"</span><span class="op">,</span> <span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  bgGradient<span class="op">.</span><span class="fu">append</span>(<span class="st">"stop"</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"offset"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stop-color"</span><span class="op">,</span> <span class="st">"#2a5298"</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stop-opacity"</span><span class="op">,</span> <span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply gradient background</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"url(#bg-gradient)"</span>)<span class="op">;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Title with glow effect</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"22px"</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"filter"</span><span class="op">,</span> <span class="st">"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"</span>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Variational Autoencoder (VAE) Architecture"</span>)<span class="op">;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define positions</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> encoderX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.25</span><span class="op">;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> muSigmaX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.4</span><span class="op">;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> latentX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.55</span><span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decoderX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.7</span><span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outputX <span class="op">=</span> width <span class="op">*</span> <span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> centerY <span class="op">=</span> height <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create neural network visualization for encoder</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> encoderGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw encoder layers</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> encoderLayers <span class="op">=</span> [<span class="dv">4</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  encoderLayers<span class="op">.</span><span class="fu">forEach</span>((neurons<span class="op">,</span> layerIdx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> neurons<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> centerY <span class="op">-</span> (neurons <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">15</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>      encoderGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> encoderX <span class="op">+</span> layerIdx <span class="op">*</span> <span class="dv">25</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> y)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#4FC3F7"</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  encoderGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> encoderX <span class="op">+</span> <span class="dv">25</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">60</span>)</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Encoder Network"</span>)<span class="op">;</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create input data visualization (as image grid)</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inputGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gridSize <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellSize <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> gridSize<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> gridSize<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>      inputGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> inputX <span class="op">-</span> gridSize <span class="op">*</span> cellSize <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> i <span class="op">*</span> cellSize)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> gridSize <span class="op">*</span> cellSize <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> j <span class="op">*</span> cellSize)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> cellSize <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> cellSize <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> <span class="dv">200</span><span class="sc">}</span><span class="vs">, 70%, </span><span class="sc">${</span><span class="dv">50</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="dv">30</span><span class="sc">}</span><span class="vs">%)`</span>)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>  inputGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> inputX)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">60</span>)</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Input Data"</span>)<span class="op">;</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mean and Variance visualization</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> muSigmaGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mean (μ)</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  muSigmaGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> muSigmaX)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> centerY <span class="op">-</span> <span class="dv">25</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FFD54F"</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  muSigmaGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> muSigmaX)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> <span class="dv">21</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"μ"</span>)<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Variance (σ)</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  muSigmaGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> muSigmaX)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">25</span>)</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#81C784"</span>)</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  muSigmaGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> muSigmaX)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">29</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"σ"</span>)<span class="op">;</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  muSigmaGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> muSigmaX)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">70</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"11px"</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Parameters"</span>)<span class="op">;</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Latent space visualization with mixture of Gaussians</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> latentGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw multiple Gaussian distributions for mixture</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gaussianCenters <span class="op">=</span> [</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> latentX <span class="op">-</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> centerY <span class="op">-</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"#E1BEE7"</span>}<span class="op">,</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> latentX <span class="op">+</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> centerY <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"#C5CAE9"</span>}<span class="op">,</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> latentX<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> centerY <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"#D1C4E9"</span>}</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw contours for each Gaussian in the mixture</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>  gaussianCenters<span class="op">.</span><span class="fu">forEach</span>((center<span class="op">,</span> gIdx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radii <span class="op">=</span> [<span class="dv">30</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">14</span>]<span class="op">;</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    radii<span class="op">.</span><span class="fu">forEach</span>((radius<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>      latentGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> center<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> center<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> radius)</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> radius <span class="op">*</span> <span class="fl">0.85</span>)</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> center<span class="op">.</span><span class="at">color</span>)</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> idx <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"2,2"</span> <span class="op">:</span> <span class="st">"none"</span>)</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.5</span> <span class="op">-</span> idx <span class="op">*</span> <span class="fl">0.12</span>)<span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sampled points from mixture</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sampledPoints <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> point <span class="op">=</span> latentGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> latentX)</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> centerY)</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FF6B6B"</span>)</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    sampledPoints<span class="op">.</span><span class="fu">push</span>(point)<span class="op">;</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Reparameterization trick visualization with proper math</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> reparamGroup <span class="op">=</span> latentGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create white background for formula</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  reparamGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> latentX <span class="op">-</span> <span class="dv">45</span>)</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> <span class="dv">65</span>)</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">90</span>)</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">28</span>)</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.95)"</span>)</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.3)"</span>)</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Main formula</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  reparamGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> latentX)</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> <span class="dv">50</span>)</span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"11px"</span>)</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#1e3c72"</span>)</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"600"</span>)</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"z = μ + σ ⊙ ε"</span>)<span class="op">;</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Distribution notation</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>  reparamGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> latentX)</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> <span class="dv">75</span>)</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"9px"</span>)</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FFECB3"</span>)</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"ε ~ 𝒩(0,I)"</span>)<span class="op">;</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>  latentGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> latentX)</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">70</span>)</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Latent Space (Mixture)"</span>)<span class="op">;</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add label for mixture</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  latentGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> latentX)</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">85</span>)</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"9px"</span>)</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#E1BEE7"</span>)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"q(z) = Σᵢ πᵢ 𝒩(μᵢ, σᵢ²)"</span>)<span class="op">;</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Decoder network</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decoderGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw decoder layers (mirror of encoder)</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decoderLayers <span class="op">=</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>]<span class="op">;</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>  decoderLayers<span class="op">.</span><span class="fu">forEach</span>((neurons<span class="op">,</span> layerIdx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> neurons<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> centerY <span class="op">-</span> (neurons <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">15</span> <span class="op">+</span> i <span class="op">*</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>      decoderGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> decoderX <span class="op">+</span> layerIdx <span class="op">*</span> <span class="dv">25</span>)</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> y)</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FF7043"</span>)</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>  decoderGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> decoderX <span class="op">+</span> <span class="dv">25</span>)</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">60</span>)</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Decoder Network"</span>)<span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Output/reconstruction visualization</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outputGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> gridSize<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> gridSize<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>      outputGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> outputX <span class="op">-</span> gridSize <span class="op">*</span> cellSize <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> i <span class="op">*</span> cellSize)</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">-</span> gridSize <span class="op">*</span> cellSize <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> j <span class="op">*</span> cellSize)</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> cellSize <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> cellSize <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> <span class="dv">200</span><span class="sc">}</span><span class="vs">, 60%, </span><span class="sc">${</span><span class="dv">45</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="dv">25</span><span class="sc">}</span><span class="vs">%)`</span>)</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.8</span>)<span class="op">;</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  outputGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> outputX)</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> centerY <span class="op">+</span> <span class="dv">60</span>)</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"12px"</span>)</span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"500"</span>)</span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Reconstruction"</span>)<span class="op">;</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Loss visualization</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lossGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>  lossGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">100</span>)</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">90</span>)</span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">200</span>)</span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">50</span>)</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.1)"</span>)</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.3)"</span>)</span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>  lossGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">65</span>)</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"11px"</span>)</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FFF9C4"</span>)</span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"ℒ = ℒrecon + ℒKL"</span>)<span class="op">;</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>  lossGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">50</span>)</span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">48</span>)</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#FFCDD2"</span>)</span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"‖x − x̂‖²"</span>)<span class="op">;</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>  lossGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">50</span>)</span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">48</span>)</span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#C5E1A5"</span>)</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-style"</span><span class="op">,</span> <span class="st">"italic"</span>)</span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"𝒟KL(q‖p)"</span>)<span class="op">;</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Connection lines</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> connections <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define arrow markers</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>  defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"arrow-white"</span>)</span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 0 10 10"</span>)</span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M 0 0 L 10 5 L 0 10 z"</span>)</span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.8)"</span>)<span class="op">;</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Connection paths</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pathData <span class="op">=</span> [</span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x1</span><span class="op">:</span> inputX <span class="op">+</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> centerY<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> encoderX <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> centerY}<span class="op">,</span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x1</span><span class="op">:</span> encoderX <span class="op">+</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> centerY<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> muSigmaX <span class="op">-</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> centerY}<span class="op">,</span></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x1</span><span class="op">:</span> muSigmaX <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> centerY<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> latentX <span class="op">-</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> centerY}<span class="op">,</span></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x1</span><span class="op">:</span> latentX <span class="op">+</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> centerY<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> decoderX <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> centerY}<span class="op">,</span></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x1</span><span class="op">:</span> decoderX <span class="op">+</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> centerY<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> outputX <span class="op">-</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> centerY}</span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>  pathData<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>    connections<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x1</span>)</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y1</span>)</span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x2</span>)</span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y2</span>)</span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.4)"</span>)</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> <span class="st">"url(#arrow-white)"</span>)<span class="op">;</span></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Play button</span></span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> button <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">60</span><span class="sc">}</span><span class="vs">, 60)`</span>)<span class="op">;</span></span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>  button<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">120</span>)</span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">35</span>)</span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.9)"</span>)</span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"filter"</span><span class="op">,</span> <span class="st">"drop-shadow(0 4px 6px rgba(0,0,0,0.2))"</span>)<span class="op">;</span></span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>  button<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">60</span>)</span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">22</span>)</span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#1e3c72"</span>)</span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"▶ Play"</span>)<span class="op">;</span></span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation function</span></span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">runAnimation</span>() {</span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reset everything</span></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>    encoderGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>    muSigmaGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>    latentGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>    decoderGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>    outputGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>    lossGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>    connections<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 1: Show encoder network</span></span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>    encoderGroup</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">500</span>)</span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>    connections</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">500</span>)</span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 2: Show μ and σ</span></span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>    muSigmaGroup</span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">1500</span>)</span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 3: Show latent space with sampling animation</span></span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>    latentGroup</span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">2500</span>)</span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Animate sampling points from mixture</span></span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>    sampledPoints<span class="op">.</span><span class="fu">forEach</span>((point<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> gaussian <span class="op">=</span> gaussianCenters[idx <span class="op">%</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>      point</span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">delay</span>(<span class="dv">3300</span> <span class="op">+</span> idx <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)</span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.9</span>)</span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> gaussian<span class="op">.</span><span class="at">x</span> <span class="op">+</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> gaussian<span class="op">.</span><span class="at">y</span> <span class="op">+</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">-</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="dv">18</span>)</span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">duration</span>(<span class="dv">400</span>)</span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)</span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 4: Show decoder</span></span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>    decoderGroup</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">4000</span>)</span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 5: Show reconstruction</span></span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>    outputGroup</span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">5000</span>)</span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 6: Show loss</span></span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>    lossGroup</span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delay</span>(<span class="dv">6000</span>)</span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add click handler</span></span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>  button<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> runAnimation)<span class="op">;</span></span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Auto-run animation on load</span></span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setTimeout</span>(runAnimation<span class="op">,</span> <span class="dv">800</span>)<span class="op">;</span></span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">yield</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="537" data-source-offset="-14368"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 536;"><span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a><span class="vs">**This animation illustrates the complete VAE process:**</span></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a><span class="vs">1. **📥 Encoding**: Input data (shown as pixel grid) is processed through the encoder neural network</span></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a><span class="vs">2. **📊 Parameters**: The encoder outputs mean (μ) and variance (σ) parameters</span></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a><span class="vs">3. **🎲 Reparameterization**: Using the formula z = μ + σ ⊙ ε where ε ~ 𝒩(0,I)</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a><span class="vs">4. **🌐 Latent Space**: Shows a mixture of Gaussians distribution with multiple modes</span></span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a><span class="vs">5. **📤 Decoding**: Sampled points are decoded through the decoder network</span></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a><span class="vs">6. **🖼️ Reconstruction**: Output attempts to reconstruct the original input</span></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a><span class="vs">7. **📉 Loss Function**: ℒ = ℒrecon + ℒKL balances reconstruction quality with regularization</span></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a><span class="vs">The visualization demonstrates how VAEs can learn complex, multimodal latent distributions while maintaining differentiability through the reparameterization trick.</span></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a><span class="vs">*Click "▶ Play" to replay the animation.*</span></span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="the-reign-of-the-gaussian-vae" class="level3">
<h3 class="anchored" data-anchor-id="the-reign-of-the-gaussian-vae">1.1. The Reign of the Gaussian VAE</h3>
<p>In the vast landscape of generative models, the Variational Autoencoder (VAE) stands as a cornerstone, celebrated for its elegant fusion of deep learning and Bayesian inference. At its heart lies a simple yet profound idea: learn a compressed, probabilistic representation of data in a lower-dimensional latent space. The default, near-universal choice for modeling this latent space, for both the prior <span class="math inline">\(p(\mathbf{z})\)</span> and the approximate posterior <span class="math inline">\(q_\phi(\mathbf{z}|\mathbf{x})\)</span>, is the Gaussian distribution.</p>
<p>This dominance is not accidental. The Gaussian offers two critical conveniences that make the entire VAE framework computationally tractable:</p>
<ol type="1">
<li><strong>The Reparameterization Trick</strong>: This technique allows us to sample from the distribution in a way that keeps the computation graph fully differentiable. For a Gaussian, it’s as simple as $ = + $, where <span class="math inline">\(\boldsymbol{\epsilon} \sim \mathcal{N}(0, I)\)</span>. This moves the stochasticity “outside” the parameters we need to learn, enabling low-variance gradients to flow freely.</li>
<li><strong>An Analytical KL Divergence</strong>: The Evidence Lower Bound (ELBO), the objective function for VAEs, contains a Kullback–Leibler (KL) divergence term that measures the “distance” between the posterior and the prior. When both are Gaussian, this term can be calculated in a simple, closed-form expression, avoiding the need for noisy Monte Carlo estimation.</li>
</ol>
<p>While convenient, this “Gaussian-by-default” approach imposes a rigid structure on the latent space that can be fundamentally at odds with the data’s true nature. The limitations are significant:</p>
<ul>
<li><strong>Unbounded Support</strong>: The Gaussian is defined over all real numbers <span class="math inline">\((-\infty, \infty)\)</span>. If the underlying factors of variation in our data are naturally bounded—such as representing angles, proportions, probabilities, or physical attributes that cannot be negative—the Gaussian is a structurally inappropriate model.</li>
<li><strong>Unimodality</strong>: A simple diagonal Gaussian has only one peak, or mode. It cannot efficiently represent data that has several distinct clusters or modes in its latent representation. The model is forced to “average” over these modes, often resulting in blurry, unrealistic samples and reconstructions.</li>
</ul>
</section>
<section id="the-quest-for-a-simple-alternative-the-cubic-polynomial" class="level3">
<h3 class="anchored" data-anchor-id="the-quest-for-a-simple-alternative-the-cubic-polynomial">1.2. The Quest for a Simple Alternative: The Cubic Polynomial</h3>
<p>This leads us to a foundational question: can we find a distribution that is nearly as simple as the Gaussian but offers greater flexibility? The most natural step up in complexity from a quadratic function (which defines the log-probability of a Gaussian) is a <strong>cubic polynomial</strong>.</p>
<p>Our goal in this post is to embark on a deep, rigorous, and exhaustive exploration of this seemingly straightforward idea. We will attempt to build a VAE latent distribution from the ground up using a standard, power-basis cubic polynomial: <span class="math display">\[
p(t) = a_3 t^3 + a_2 t^2 + a_1 t + a_0
\]</span> To make our analysis concrete, we will define this distribution over the symmetric, bounded interval <span class="math inline">\([-1, 1]\)</span>. We aim for our final model to have <strong>three tunable parameters</strong> that a neural network can learn, creating a direct analogy to the two tunable parameters (mean and standard deviation) of the Gaussian.</p>
<p>This post will be a detailed mathematical journey. We will derive, from first principles, the precise and surprisingly complex constraints that the coefficients <span class="math inline">\((a_0, a_1, a_2, a_3)\)</span> must satisfy for <span class="math inline">\(p(t)\)</span> to be a valid probability density function. We will discover that enforcing these constraints within a neural network is a formidable challenge, leading us to a crucial insight about the nature of model design. This exploration will ultimately reveal why alternative approaches, such as using a different polynomial basis, are not just a matter of preference but a necessary step for creating a robust and practical model.</p>
<hr>
</section>
</section>
<section id="the-labyrinth-of-constraints-deriving-a-power-basis-cubic-pdf" class="level2">
<h2 class="anchored" data-anchor-id="the-labyrinth-of-constraints-deriving-a-power-basis-cubic-pdf">2. The Labyrinth of Constraints: Deriving a Power-Basis Cubic PDF</h2>
<p>For our polynomial <span class="math inline">\(p(t)\)</span> to serve as a valid Probability Density Function (PDF) on the interval <span class="math inline">\([-1, 1]\)</span>, it must satisfy two non-negotiable axioms of probability theory:</p>
<ol type="1">
<li><strong>Normalization</strong>: The total probability over the entire sample space must equal one. <span class="math display">\[ \int_{-1}^{1} p(t) dt = 1 \]</span></li>
<li><strong>Non-negativity</strong>: The probability density must be non-negative everywhere within the sample space. <span class="math display">\[ p(t) \ge 0 \quad \text{for all} \quad t \in [-1, 1] \]</span></li>
</ol>
<p>While these axioms seem simple, applying them to a power-basis polynomial unveils a web of interconnected constraints.</p>
<section id="the-normalization-constraint-a-first-simplification" class="level3">
<h3 class="anchored" data-anchor-id="the-normalization-constraint-a-first-simplification">2.1. The Normalization Constraint: A First Simplification</h3>
<p>Let’s begin by enforcing the normalization axiom. We integrate our polynomial <span class="math inline">\(p(t) = a_3 t^3 + a_2 t^2 + a_1 t + a_0\)</span> over the symmetric interval <span class="math inline">\([-1, 1]\)</span>: <span class="math display">\[
\int_{-1}^{1} (a_3 t^3 + a_2 t^2 + a_1 t + a_0) dt = 1
\]</span> A key property of definite integrals is that any odd function (where <span class="math inline">\(f(-x) = -f(x)\)</span>) integrated over a symmetric interval is zero. In our polynomial, the terms <span class="math inline">\(a_3 t^3\)</span> and <span class="math inline">\(a_1 t\)</span> are odd functions. <span class="math display">\[
\int_{-1}^{1} (a_3 t^3 + a_1 t) dt = \left[ \frac{a_3}{4}t^4 + \frac{a_1}{2}t^2 \right]_{-1}^{1} = \left(\frac{a_3}{4} + \frac{a_1}{2}\right) - \left(\frac{a_3(-1)^4}{4} + \frac{a_1(-1)^2}{2}\right) = 0
\]</span> The even function terms, <span class="math inline">\(a_2 t^2\)</span> and <span class="math inline">\(a_0\)</span>, survive. Their integral over a symmetric interval is twice the integral over the positive half. <span class="math display">\[
\int_{-1}^{1} (a_2 t^2 + a_0) dt = 2 \int_{0}^{1} (a_2 t^2 + a_0) dt = 2 \left[ \frac{a_2}{3}t^3 + a_0 t \right]_{0}^{1} = 2\left(\frac{a_2}{3} + a_0\right)
\]</span> Setting this result to 1 gives us our first major constraint on the coefficients: <span class="math display">\[
2\left(\frac{a_2}{3} + a_0\right) = 1 \quad \implies \quad \boxed{a_0 = \frac{1}{2} - \frac{a_2}{3}}
\]</span> This is a powerful result. The normalization requirement has eliminated one of our four degrees of freedom. This means we are left with exactly <strong>three free parameters</strong>—<span class="math inline">\(a_1, a_2, a_3\)</span>—which a neural network can learn. This aligns perfectly with our initial goal. Our normalized cubic PDF now takes the form: <span class="math display">\[
p(t) = a_3 t^3 + a_2 t^2 + a_1 t + \left(\frac{1}{2} - \frac{a_2}{3}\right)
\]</span></p>
</section>
<section id="the-non-negativity-constraint-the-true-challenge" class="level3">
<h3 class="anchored" data-anchor-id="the-non-negativity-constraint-the-true-challenge">2.2. The Non-Negativity Constraint: The True Challenge</h3>
<p>This is where the apparent simplicity of the cubic polynomial reveals its hidden complexity. We must guarantee that <span class="math inline">\(p(t) \ge 0\)</span> for <strong>every</strong> point <span class="math inline">\(t \in [-1, 1]\)</span>. For a continuous function on a closed interval, this is equivalent to ensuring that its value at the boundaries and at any internal local minima is non-negative.</p>
<section id="step-1-boundary-conditions" class="level4">
<h4 class="anchored" data-anchor-id="step-1-boundary-conditions">Step 1: Boundary Conditions</h4>
<p>First, we evaluate <span class="math inline">\(p(t)\)</span> at the interval boundaries, <span class="math inline">\(t=1\)</span> and <span class="math inline">\(t=-1\)</span>, and require them to be non-negative. For <span class="math inline">\(t=1\)</span>: <span class="math display">\[
p(1) = a_3(1)^3 + a_2(1)^2 + a_1(1) + \left(\frac{1}{2} - \frac{a_2}{3}\right) = a_3 + a_1 + \frac{2a_2}{3} + \frac{1}{2} \ge 0
\]</span> For <span class="math inline">\(t=-1\)</span>: <span class="math display">\[
p(-1) = a_3(-1)^3 + a_2(-1)^2 + a_1(-1) + \left(\frac{1}{2} - \frac{a_2}{3}\right) = -a_3 - a_1 + \frac{2a_2}{3} + \frac{1}{2} \ge 0
\]</span> These two linear inequalities can be combined. Adding them together gives a simple bound on <span class="math inline">\(a_2\)</span>: <span class="math display">\[
(p(1) + p(-1)) = \left(a_3 + a_1 + \frac{2a_2}{3} + \frac{1}{2}\right) + \left(-a_3 - a_1 + \frac{2a_2}{3} + \frac{1}{2}\right) = \frac{4a_2}{3} + 1 \ge 0 \implies \boxed{a_2 \ge -\frac{3}{4}}
\]</span> This also gives us a condition on the combination of <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_3\)</span>. From the two inequalities, we must have: <span class="math display">\[
a_3 + a_1 \ge -\left(\frac{2a_2}{3} + \frac{1}{2}\right) \quad \text{and} \quad -(a_3 + a_1) \ge -\left(\frac{2a_2}{3} + \frac{1}{2}\right)
\]</span> This is equivalent to: <span class="math display">\[
\boxed{|a_3 + a_1| \le \frac{2a_2}{3} + \frac{1}{2}}
\]</span> So far, these constraints, while interconnected, are still manageable.</p>
</section>
<section id="step-2-internal-extrema-conditions" class="level4">
<h4 class="anchored" data-anchor-id="step-2-internal-extrema-conditions">Step 2: Internal Extrema Conditions</h4>
<p>The most difficult part of the problem arises from the internal minima. A local minimum can only occur where the derivative of the function is zero. Let’s find the derivative of our PDF: <span class="math display">\[
p'(t) = \frac{d}{dt} \left(a_3 t^3 + a_2 t^2 + a_1 t + a_0\right) = 3a_3 t^2 + 2a_2 t + a_1
\]</span> We must find the roots of <span class="math inline">\(p'(t)=0\)</span>, which is a standard quadratic equation. The locations of the extrema are given by the quadratic formula: <span class="math display">\[
t^{*}_{\pm} = \frac{-2a_2 \pm \sqrt{(2a_2)^2 - 4(3a_3)(a_1)}}{2(3a_3)} = \frac{-a_2 \pm \sqrt{a_2^2 - 3a_1 a_3}}{3a_3}
\]</span> The behavior depends on the discriminant, <span class="math inline">\(\Delta = a_2^2 - 3a_1 a_3\)</span>.</p>
<ul>
<li><p><strong>Case 1: <span class="math inline">\(\Delta &lt; 0\)</span></strong>. If the discriminant is negative, there are no real roots. The derivative <span class="math inline">\(p'(t)\)</span> is never zero, meaning the function <span class="math inline">\(p(t)\)</span> is monotonic over the entire interval. In this case, its minimum value must be at one of the boundaries, <span class="math inline">\(t=-1\)</span> or <span class="math inline">\(t=1\)</span>. Since we already handled the boundary conditions, no further work is needed. This case holds if <span class="math inline">\(a_2^2 &lt; 3a_1 a_3\)</span>.</p></li>
<li><p><strong>Case 2: <span class="math inline">\(\Delta \ge 0\)</span></strong>. If the discriminant is non-negative, there are one or two real roots. For each root <span class="math inline">\(t^*\)</span> that is a local minimum, we have a new check:</p>
<ol type="1">
<li>Does this minimum lie <strong>inside</strong> our interval, i.e., <span class="math inline">\(t^* \in (-1, 1)\)</span>?</li>
<li>If it does, we must enforce the new, non-linear constraint <span class="math inline">\(p(t^*) \ge 0\)</span>.</li>
</ol></li>
</ul>
<p>Let’s imagine the root <span class="math inline">\(t^* = \frac{-a_2 + \sqrt{\Delta}}{3a_3}\)</span> is a local minimum inside <span class="math inline">\((-1, 1)\)</span>. We would need to enforce: <span class="math display">\[
a_3 (t^*)^3 + a_2 (t^*)^2 + a_1 t^* + \left(\frac{1}{2} - \frac{a_2}{3}\right) \ge 0
\]</span> Substituting the complex expression for <span class="math inline">\(t^*\)</span> into this inequality results in a deeply complex, non-linear constraint on the parameters <span class="math inline">\(a_1, a_2, a_3\)</span>. It involves square roots and polynomials of the parameters themselves, defining a bizarrely shaped valid region in the 3D parameter space.</p>
</section>
</section>
<section id="conclusion-the-impracticality-of-the-power-basis" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-the-impracticality-of-the-power-basis">2.3. Conclusion: The Impracticality of the Power Basis</h3>
<p>To use this PDF in a VAE, an encoder would need to output three unconstrained real numbers, say from a linear layer. We would then need a differentiable function that maps these three numbers into the valid, constrained space of <span class="math inline">\((a_1, a_2, a_3)\)</span>.</p>
<p>The constraints we derived are: 1. <span class="math inline">\(a_2 \ge -\frac{3}{4}\)</span> 2. <span class="math inline">\(|a_3 + a_1| \le \frac{2a_2}{3} + \frac{1}{2}\)</span> 3. A highly complex, conditional, non-linear constraint involving <span class="math inline">\(p(t^*) \ge 0\)</span> that only applies when <span class="math inline">\(a_2^2 \ge 3a_1 a_3\)</span> and when the resulting <span class="math inline">\(t^*\)</span> falls within <span class="math inline">\((-1, 1)\)</span>.</p>
<p>Finding a closed-form, differentiable mapping that enforces this entire set of conditions is, for all practical purposes, impossible. The “simple” power-basis polynomial has led us to an intractable parameterization problem. This is a crucial realization: <strong>the simplicity of a model’s definition does not imply simplicity of its use in optimization.</strong></p>
<p>This deep dive motivates the search for a better way. Instead of starting with a simple form and deriving complex constraints, what if we started with simple constraints and derived a more complex form? This is the philosophy that leads us to the Bernstein basis.</p>
<hr>
</section>
</section>
<section id="a-constructive-solution-the-bernstein-basis" class="level2">
<h2 class="anchored" data-anchor-id="a-constructive-solution-the-bernstein-basis">3. A Constructive Solution: The Bernstein Basis</h2>
<p>The analysis in Part 1 reveals a crucial insight: ensuring the non-negativity of a polynomial in power-basis form is mathematically complex. The solution is not to wrestle with these intractable constraints, but to choose a different basis for our polynomial—one where the non-negativity is guaranteed by construction.</p>
<p>This is precisely what <strong>Bernstein basis polynomials</strong> offer. For a degree-3 polynomial on the interval <span class="math inline">\([0, 1]\)</span>, the basis functions are: <span class="math display">\[
\begin{aligned}
B_0(t) &amp;= \binom{3}{0} t^0 (1-t)^3 = (1-t)^3 \\
B_1(t) &amp;= \binom{3}{1} t^1 (1-t)^2 = 3t(1-t)^2 \\
B_2(t) &amp;= \binom{3}{2} t^2 (1-t)^1 = 3t^2(1-t) \\
B_3(t) &amp;= \binom{3}{3} t^3 (1-t)^0 = t^3
\end{aligned}
\]</span> These functions are all <strong>non-negative</strong> for <span class="math inline">\(t \in [0, 1]\)</span>. This property is the key.</p>
<p>We can now define our PDF as a linear combination of these basis functions: <span class="math display">\[
p(t;\mathbf{c}) = \sum_{k=0}^3 c_k B_k(t)
\]</span> If we enforce the simple constraint that all coefficients <span class="math inline">\(c_k \ge 0\)</span>, the non-negativity of <span class="math inline">\(p(t)\)</span> is automatically guaranteed.</p>
<section id="normalization-of-the-bernstein-cubic" class="level3">
<h3 class="anchored" data-anchor-id="normalization-of-the-bernstein-cubic">3.1. Normalization of the Bernstein-Cubic</h3>
<p>For the normalization, we integrate each basis function over <span class="math inline">\([0, 1]\)</span>. This integral is a classic result related to the Beta function, <span class="math inline">\(\int_0^1 t^x (1-t)^y dt = \frac{x!y!}{(x+y+1)!}\)</span>. <span class="math display">\[
\int_0^1 B_k(t)\,dt = \binom{3}{k} \int_0^1 t^k (1-t)^{3-k} dt = \frac{3!}{k!(3-k)!} \frac{k!(3-k)!}{(3+1)!} = \frac{3!}{4!} = \frac{1}{4}
\]</span> Therefore, the integral of our PDF is: <span class="math display">\[
\int_0^1 p(t;\mathbf{c})\,dt = \sum_{k=0}^3 c_k \int_0^1 B_k(t)\,dt = \frac{1}{4}\sum_{k=0}^3 c_k
\]</span> To make this equal 1, we only need to enforce <span class="math inline">\(\sum_{k=0}^3 c_k = 4\)</span>.</p>
<p>So, our two simple, elegant constraints are: <span class="math display">\[
c_k \ge 0 \quad \text{and} \quad \sum_{k=0}^3 c_k = 4
\]</span> A neural network can easily produce parameters satisfying these constraints by outputting a 4-dimensional vector <span class="math inline">\(\boldsymbol{\alpha}\)</span> and setting <span class="math inline">\(\mathbf{c} = 4 \cdot \text{softmax}(\boldsymbol{\alpha})\)</span>. This gives us <strong>3 effective tunable parameters</strong>, as one is fixed by the sum constraint.</p>
</section>
<section id="cdf-sampling-and-gradients" class="level3">
<h3 class="anchored" data-anchor-id="cdf-sampling-and-gradients">3.2. CDF, Sampling, and Gradients</h3>
<p>The path forward is now clear and practical: - <strong>CDF</strong>: The Cumulative Distribution Function is <span class="math inline">\(F(t;\mathbf{c}) = \sum_{k=0}^3 c_k I_k(t)\)</span>, where <span class="math inline">\(I_k(t)\)</span> are the simple polynomial antiderivatives of <span class="math inline">\(B_k(t)\)</span>. - <strong>Sampling</strong>: We can find a sample <span class="math inline">\(t\)</span> by numerically solving <span class="math inline">\(F(t;\mathbf{c}) = u\)</span> for a uniform random variable <span class="math inline">\(u \sim \mathrm{Uniform}(0,1)\)</span>. Robust methods like Newton’s method combined with bisection are effective, as the PDF <span class="math inline">\(p(t) = F'(t)\)</span> is guaranteed non-negative. - <strong>Gradients</strong>: The pathwise gradient for reparameterization, <span class="math inline">\(\frac{\partial t}{\partial c_r}\)</span>, is found using the implicit function theorem, resulting in a clean, analytical expression for backpropagation.</p>
<p>By switching to the Bernstein basis, we have transformed an intractable problem into an elegant, practical, and robust framework.</p>
<hr>
</section>
</section>
<section id="the-vae-framework-with-a-bernstein-cubic-latent" class="level2">
<h2 class="anchored" data-anchor-id="the-vae-framework-with-a-bernstein-cubic-latent">4. The VAE Framework with a Bernstein-Cubic Latent</h2>
<p>We now formalize the VAE using our robust Bernstein-cubic distribution. We will define it on <span class="math inline">\([0, 1]\)</span> for simplicity, but it can be affinely transformed to any interval <span class="math inline">\([L, U]\)</span>.</p>
<ul>
<li><strong>Encoder &amp; Posterior</strong>: The encoder network <span class="math inline">\(E_\phi(\mathbf{x})\)</span> outputs a vector <span class="math inline">\(\boldsymbol{\alpha}_q \in \mathbb{R}^4\)</span> for each latent dimension. The posterior coefficients are <span class="math inline">\(\mathbf{c}_q = 4 \cdot \text{softmax}(\boldsymbol{\alpha}_q)\)</span>.</li>
<li><strong>Prior</strong>: The prior <span class="math inline">\(p_\psi(\mathbf{z})\)</span> is defined by a set of learnable parameters <span class="math inline">\(\boldsymbol{\alpha}_p \in \mathbb{R}^4\)</span> for each latent dimension, with <span class="math inline">\(\mathbf{c}_p = 4 \cdot \text{softmax}(\boldsymbol{\alpha}_p)\)</span>.</li>
</ul>
<section id="the-elbo-in-full-detail" class="level3">
<h3 class="anchored" data-anchor-id="the-elbo-in-full-detail">4.1. The ELBO in Full Detail</h3>
<p>The Evidence Lower Bound (ELBO) is: <span class="math display">\[
\mathcal{L}(\phi, \psi, \theta) = \mathbb{E}_{q_\phi(\mathbf{z}|\mathbf{x})} [\log p_\theta(\mathbf{x}|\mathbf{z})] - \text{KL}(q_\phi(\mathbf{z}|\mathbf{x}) || p_\psi(\mathbf{z}))
\]</span></p>
<section id="why-the-kl-divergence-is-intractable" class="level4">
<h4 class="anchored" data-anchor-id="why-the-kl-divergence-is-intractable">Why the KL-divergence is intractable</h4>
<p>The KL-divergence between the posterior and prior is: <span class="math display">\[
\text{KL}(q_\phi(\mathbf{z}|\mathbf{x}) || p_\psi(\mathbf{z})) = \mathbb{E}_{q_\phi(\mathbf{z}|\mathbf{x})} \left[ \log \frac{q_\phi(\mathbf{z}|\mathbf{x})}{p_\psi(\mathbf{z})} \right]
\]</span></p>
<p>For our Bernstein-cubic distributions with factorized dimensions, this becomes: <span class="math display">\[
\text{KL} = \sum_{j=1}^d \mathbb{E}_{q_{\phi,j}(z_j|\mathbf{x})} \left[ \log \frac{q_{\phi,j}(z_j|\mathbf{x})}{p_{\psi,j}(z_j)} \right]
\]</span></p>
<p>For each dimension <span class="math inline">\(j\)</span>, where both distributions are Bernstein-cubic polynomials: <span class="math display">\[
q_{\phi,j}(z_j|\mathbf{x}) = \sum_{k=0}^3 c^{(q)}_{j,k}(\mathbf{x}) B_k(t_j), \quad p_{\psi,j}(z_j) = \sum_{k=0}^3 c^{(p)}_{j,k} B_k(t_j)
\]</span></p>
<p>The KL-divergence per dimension requires computing: <span class="math display">\[
\text{KL}_j = \int_0^1 \left(\sum_{k=0}^3 c^{(q)}_{j,k} B_k(t)\right) \log \frac{\sum_{k=0}^3 c^{(q)}_{j,k} B_k(t)}{\sum_{k=0}^3 c^{(p)}_{j,k} B_k(t)} dt
\]</span></p>
<p>This integral has no closed-form solution because: 1. The logarithm of a ratio of cubic polynomials is not a polynomial 2. The product of a cubic polynomial with the log of a ratio of cubics creates a highly complex integrand 3. Unlike the Gaussian case (where both distributions are exponential-quadratic), there’s no algebraic simplification available</p>
<p>Therefore, we must resort to the Monte Carlo formulation: <span class="math display">\[
\mathcal{L} \approx \frac{1}{S} \sum_{s=1}^S \left( \log p_\theta(\mathbf{x}|\mathbf{z}^{(s)}) + \log p_\psi(\mathbf{z}^{(s)}) - \log q_\phi(\mathbf{z}^{(s)}|\mathbf{x}) \right)
\]</span> where <span class="math inline">\(\mathbf{z}^{(s)}\)</span> is a sample from the posterior <span class="math inline">\(q_\phi(\mathbf{z}|\mathbf{x})\)</span> obtained via inverse-CDF sampling.</p>
<p>Each term is now fully differentiable: - <span class="math inline">\(\log p_\theta(\mathbf{x}|\mathbf{z})\)</span>: The standard reconstruction loss. Gradients flow through the decoder and back to the sample <span class="math inline">\(\mathbf{z}\)</span>. - <span class="math inline">\(\log p_\psi(\mathbf{z})\)</span>: The log-probability of the sample under the prior. Gradients flow to the prior’s parameters <span class="math inline">\(\boldsymbol{\alpha}_p\)</span>. - <span class="math inline">\(\log q_\phi(\mathbf{z}|\mathbf{x})\)</span>: The log-probability under the posterior.</p>
<p>The total gradient for the encoder parameters <span class="math inline">\(\boldsymbol{\alpha}_q\)</span> has two components: 1. <strong>Pathwise Gradient</strong>: From the <span class="math inline">\(\log p_\theta\)</span> and <span class="math inline">\(\log p_\psi\)</span> terms, flowing “through” the sample <span class="math inline">\(\mathbf{z}\)</span> via the implicit function theorem. 2. <strong>Score Function Gradient</strong>: From the <span class="math inline">\(-\log q_\phi\)</span> term, which depends directly on <span class="math inline">\(\boldsymbol{\alpha}_q\)</span>.</p>
</section>
</section>
<section id="elbo-step-by-step-derivation-and-per-dimension-form" class="level3">
<h3 class="anchored" data-anchor-id="elbo-step-by-step-derivation-and-per-dimension-form">4.2. ELBO: Step-by-step derivation and per-dimension form</h3>
<p>We consider a factorized latent across dimensions <span class="math inline">\(j=1,\dots,d\)</span>: <span class="math display">\[
q_\phi(\mathbf{z}|\mathbf{x})=\prod_{j=1}^d q_{\phi,j}(z_j|\mathbf{x}),\quad p_\psi(\mathbf{z})=\prod_{j=1}^d p_{\psi,j}(z_j).
\]</span> For each dimension defined on <span class="math inline">\([L_j,U_j]\)</span>, introduce the affine transform <span class="math inline">\(t_j=(z_j-L_j)/(U_j-L_j)\in[0,1]\)</span>. The posterior and prior densities are <span class="math display">\[
q_{\phi,j}(z_j|\mathbf{x})=\frac{1}{U_j-L_j}\sum_{k=0}^3 c^{(q)}_{j,k}(\mathbf{x})\,B_k(t_j),\quad
p_{\psi,j}(z_j)=\frac{1}{U_j-L_j}\sum_{k=0}^3 c^{(p)}_{j,k}\,B_k(t_j),
\]</span> with coefficients constrained via softmax: <span class="math inline">\(\mathbf{c}^{(q)}_{j}=4\,\text{softmax}(\boldsymbol{\alpha}^{(q)}_j(\mathbf{x}))\)</span>, <span class="math inline">\(\mathbf{c}^{(p)}_{j}=4\,\text{softmax}(\boldsymbol{\alpha}^{(p)}_j)\)</span>.</p>
<p>The ELBO for a single datum <span class="math inline">\(\mathbf{x}\)</span> is <span class="math display">\[
\mathcal{L}(\mathbf{x})=\mathbb{E}_{q_\phi(\mathbf{z}|\mathbf{x})}[\log p_\theta(\mathbf{x}|\mathbf{z})]\;-
\mathbb{E}_{q_\phi(\mathbf{z}|\mathbf{x})}\Big[\log q_\phi(\mathbf{z}|\mathbf{x})-\log p_\psi(\mathbf{z})\Big].
\]</span> Using Monte Carlo with <span class="math inline">\(S\)</span> samples <span class="math inline">\(\mathbf{z}^{(s)}\sim q_\phi(\cdot|\mathbf{x})\)</span>: <span class="math display">\[
\widehat{\mathcal{L}}(\mathbf{x})=\frac{1}{S}\sum_{s=1}^S \Big(\log p_\theta(\mathbf{x}|\mathbf{z}^{(s)})+\sum_{j=1}^d \log p_{\psi,j}(z^{(s)}_j)-\sum_{j=1}^d \log q_{\phi,j}(z^{(s)}_j|\mathbf{x})\Big).
\]</span> Explicitly, for each dimension <span class="math inline">\(j\)</span>: <span class="math display">\[
\log q_{\phi,j}(z_j|\mathbf{x})=\log\Big(\sum_{k=0}^3 c^{(q)}_{j,k}(\mathbf{x})\,B_k(t_j)\Big)-\log(U_j-L_j),
\]</span> <span class="math display">\[
\log p_{\psi,j}(z_j)=\log\Big(\sum_{k=0}^3 c^{(p)}_{j,k}\,B_k(t_j)\Big)-\log(U_j-L_j).
\]</span> The <span class="math inline">\(-\log(U_j-L_j)\)</span> terms cancel in the KL difference per dimension, yielding a numerically nicer objective.</p>
<section id="pathwise-sampling-and-gradients" class="level4">
<h4 class="anchored" data-anchor-id="pathwise-sampling-and-gradients">Pathwise sampling and gradients</h4>
<p>For each <span class="math inline">\(j\)</span>, draw <span class="math inline">\(u_j\sim\text{Uniform}(0,1)\)</span> and solve <span class="math inline">\(F_{q,j}(t_j;\mathbf{c}^{(q)}_j(\mathbf{x}))=u_j\)</span> for <span class="math inline">\(t_j\in[0,1]\)</span>, then set <span class="math inline">\(z_j=L_j+(U_j-L_j)\,t_j\)</span>. Implicit differentiation of <span class="math inline">\(F_{q,j}(t_j;\mathbf{c}^{(q)}_j)=u_j\)</span> gives <span class="math display">\[
\frac{\partial t_j}{\partial c^{(q)}_{j,r}}=-\,\frac{I_r(t_j)}{\sum_{k=0}^3 c^{(q)}_{j,k}\,B_k(t_j)}.
\]</span> Gradients w.r.t. prior coefficients are direct: <span class="math display">\[
\frac{\partial}{\partial c^{(p)}_{j,r}}\log p_{\psi,j}(z_j)=\frac{B_r(t_j)}{\sum_{k=0}^3 c^{(p)}_{j,k}\,B_k(t_j)}.
\]</span> Direct gradients for the posterior log term are <span class="math display">\[
\frac{\partial}{\partial c^{(q)}_{j,r}}\big(-\log q_{\phi,j}(z_j|\mathbf{x})\big)=-\,\frac{B_r(t_j)}{\sum_{k=0}^3 c^{(q)}_{j,k}\,B_k(t_j)}.
\]</span> Pathwise gradients propagate through <span class="math inline">\(t_j\)</span> and <span class="math inline">\(z_j\)</span> into the reconstruction <span class="math inline">\(\log p_\theta\)</span> and prior <span class="math inline">\(\log p_\psi\)</span>. If <span class="math inline">\(c=4\,\text{softmax}(\alpha)\)</span>, then <span class="math inline">\(\partial c_s/\partial\alpha_r=4\,s_s(\delta_{sr}-s_r)\)</span>.</p>
</section>
<section id="interval-choice-and-invariances" class="level4">
<h4 class="anchored" data-anchor-id="interval-choice-and-invariances">Interval choice and invariances</h4>
<ul>
<li>Changing support from <span class="math inline">\([0,1]\)</span> to <span class="math inline">\([L_j,U_j]\)</span> adds a constant <span class="math inline">\(-\log(U_j-L_j)\)</span> to both <span class="math inline">\(\log q\)</span> and <span class="math inline">\(\log p\)</span>; it cancels in the <span class="math inline">\(\mathrm{KL}\)</span>.</li>
<li>Using the same <span class="math inline">\([L_j,U_j]\)</span> for <span class="math inline">\(q\)</span> and <span class="math inline">\(p\)</span> per dimension avoids support mismatch.</li>
</ul>
</section>
<section id="numerical-stability" class="level4">
<h4 class="anchored" data-anchor-id="numerical-stability">Numerical stability</h4>
<p>Use <span class="math inline">\(\log(\sum c_k B_k(t)+\varepsilon)\)</span> with small <span class="math inline">\(\varepsilon\)</span>, and clip Newton steps with bracketing to ensure monotone CDF inversion.</p>
<hr>
</section>
</section>
</section>
<section id="pytorch-implementation" class="level2">
<h2 class="anchored" data-anchor-id="pytorch-implementation">5. PyTorch Implementation</h2>
<p>This implementation demonstrates the complete pipeline, including the custom autograd function for differentiable inverse-CDF sampling.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bernstein3(t):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the Bernstein basis polynomials of degree 3."""</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    B0 <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">-</span> t)<span class="op">**</span><span class="dv">3</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    B1 <span class="op">=</span> <span class="fl">3.0</span> <span class="op">*</span> t <span class="op">*</span> (<span class="fl">1.0</span> <span class="op">-</span> t)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    B2 <span class="op">=</span> <span class="fl">3.0</span> <span class="op">*</span> t<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (<span class="fl">1.0</span> <span class="op">-</span> t)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    B3 <span class="op">=</span> t<span class="op">**</span><span class="dv">3</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.stack([B0, B1, B2, B3], dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> I_bernstein3(t):</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the antiderivatives of the Bernstein basis polynomials."""</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    I0 <span class="op">=</span> t <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span>t<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> t<span class="op">**</span><span class="dv">3</span> <span class="op">-</span> <span class="fl">0.25</span><span class="op">*</span>t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    I1 <span class="op">=</span> <span class="fl">1.5</span><span class="op">*</span>t<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="fl">2.0</span><span class="op">*</span>t<span class="op">**</span><span class="dv">3</span> <span class="op">+</span> <span class="fl">0.75</span><span class="op">*</span>t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    I2 <span class="op">=</span> t<span class="op">**</span><span class="dv">3</span> <span class="op">-</span> <span class="fl">0.75</span><span class="op">*</span>t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    I3 <span class="op">=</span> <span class="fl">0.25</span><span class="op">*</span>t<span class="op">**</span><span class="dv">4</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.stack([I0, I1, I2, I3], dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> softmax_to_c(alpha):</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Converts unconstrained parameters to valid Bernstein coefficients."""</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">4.0</span> <span class="op">*</span> F.softmax(alpha, dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cubic_pdf01(t, alpha, eps<span class="op">=</span><span class="fl">1e-12</span>):</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the cubic PDF on [0,1]."""</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> softmax_to_c(alpha)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> bernstein3(t)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (c <span class="op">*</span> B).<span class="bu">sum</span>(dim<span class="op">=-</span><span class="dv">1</span>).clamp_min(eps)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cubic_cdf01(t, alpha):</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the cubic CDF on [0,1]."""</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> softmax_to_c(alpha)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    I <span class="op">=</span> I_bernstein3(t)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (c <span class="op">*</span> I).<span class="bu">sum</span>(dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="at">@torch.no_grad</span>()</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inv_cdf01_solver(u, alpha, iters<span class="op">=</span><span class="dv">12</span>, eps<span class="op">=</span><span class="fl">1e-12</span>):</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Robust numerical solver for the inverse CDF."""</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> u.clone()</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    lo, hi <span class="op">=</span> torch.zeros_like(u), torch.ones_like(u)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(iters):</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        Fval <span class="op">=</span> cubic_cdf01(t, alpha)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        pdf  <span class="op">=</span> cubic_pdf01(t, alpha, eps<span class="op">=</span>eps)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> Fval <span class="op">-</span> u</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        newton <span class="op">=</span> (diff <span class="op">/</span> pdf).clamp(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        t_new <span class="op">=</span> (t <span class="op">-</span> newton).clamp(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> diff <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        hi <span class="op">=</span> torch.where(mask, t, hi)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        lo <span class="op">=</span> torch.where(<span class="op">~</span>mask, t, lo)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        escaped <span class="op">=</span> (t_new <span class="op">&lt;</span> lo) <span class="op">|</span> (t_new <span class="op">&gt;</span> hi)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> torch.where(escaped, <span class="fl">0.5</span> <span class="op">*</span> (lo <span class="op">+</span> hi), t_new)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> InverseCDFBernstein3(torch.autograd.Function):</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(ctx, u, alpha):</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> inv_cdf01_solver(u, alpha)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        ctx.save_for_backward(t, alpha)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> t</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backward(ctx, grad_out):</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>        t, alpha <span class="op">=</span> ctx.saved_tensors</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        B <span class="op">=</span> bernstein3(t)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        I <span class="op">=</span> I_bernstein3(t)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> softmax_to_c(alpha)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        pdf <span class="op">=</span> (c <span class="op">*</span> B).<span class="bu">sum</span>(dim<span class="op">=-</span><span class="dv">1</span>).clamp_min(<span class="fl">1e-12</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        dt_dc <span class="op">=</span> <span class="op">-</span>I <span class="op">/</span> pdf.unsqueeze(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> c <span class="op">/</span> <span class="fl">4.0</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> dt_dc <span class="op">*</span> (<span class="fl">4.0</span> <span class="op">*</span> s)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        v_sum <span class="op">=</span> v.<span class="bu">sum</span>(dim<span class="op">=-</span><span class="dv">1</span>, keepdim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        dtdalpha <span class="op">=</span> v <span class="op">-</span> s <span class="op">*</span> v_sum</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        grad_alpha <span class="op">=</span> grad_out.unsqueeze(<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> dtdalpha</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, grad_alpha</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample_q01(alpha):</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Differentiably sample from the cubic distribution on [0,1]."""</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    shape <span class="op">=</span> alpha.shape[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> torch.rand(shape, device<span class="op">=</span>alpha.device)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> InverseCDFBernstein3.<span class="bu">apply</span>(u, alpha)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Encoder(nn.Module):</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x_dim, h_dim, z_dim):</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.net <span class="op">=</span> nn.Sequential(</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>            nn.Linear(x_dim, h_dim), nn.ReLU(),</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>            nn.Linear(h_dim, z_dim <span class="op">*</span> <span class="dv">4</span>)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.net(x).view(x.size(<span class="dv">0</span>), <span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Decoder(nn.Module):</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, z_dim, h_dim, x_dim):</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.net <span class="op">=</span> nn.Sequential(</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            nn.Linear(z_dim, h_dim), nn.ReLU(),</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>            nn.Linear(h_dim, x_dim)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, z):</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.net(z)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CubicVAE(nn.Module):</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x_dim, h_dim, z_dim, L<span class="op">=</span><span class="fl">0.0</span>, U<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.enc <span class="op">=</span> Encoder(x_dim, h_dim, z_dim)</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dec <span class="op">=</span> Decoder(z_dim, h_dim, x_dim)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.z_dim <span class="op">=</span> z_dim</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.L <span class="op">=</span> L</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.U <span class="op">=</span> U</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.alpha_p <span class="op">=</span> nn.Parameter(torch.zeros(z_dim, <span class="dv">4</span>))</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x, S<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>        B <span class="op">=</span> x.size(<span class="dv">0</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>        alpha_q <span class="op">=</span> <span class="va">self</span>.enc(x)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>        elbo <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(S):</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> sample_q01(alpha_q)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>            z <span class="op">=</span> <span class="va">self</span>.L <span class="op">+</span> (<span class="va">self</span>.U <span class="op">-</span> <span class="va">self</span>.L) <span class="op">*</span> t</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>            logits <span class="op">=</span> <span class="va">self</span>.dec(z)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>            log_px <span class="op">=</span> <span class="op">-</span>F.binary_cross_entropy_with_logits(</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                logits, x, reduction<span class="op">=</span><span class="st">'none'</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>            ).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>            log_pz <span class="op">=</span> <span class="va">self</span>.log_pdf(z, <span class="va">self</span>.alpha_p.expand(B, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>            log_qz <span class="op">=</span> <span class="va">self</span>.log_pdf(z, alpha_q).<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>            elbo <span class="op">=</span> elbo <span class="op">+</span> (log_px <span class="op">+</span> log_pz <span class="op">-</span> log_qz)</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> elbo <span class="op">/</span> S</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> log_pdf(<span class="va">self</span>, z, alpha):</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> (z <span class="op">-</span> <span class="va">self</span>.L) <span class="op">/</span> (<span class="va">self</span>.U <span class="op">-</span> <span class="va">self</span>.L)</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>        log_p01 <span class="op">=</span> torch.log(cubic_pdf01(t, alpha))</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> log_p01 <span class="op">-</span> torch.log(torch.tensor(<span class="va">self</span>.U <span class="op">-</span> <span class="va">self</span>.L, device<span class="op">=</span>z.device))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="conclusion-from-a-simple-idea-to-a-rigorous-solution" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-from-a-simple-idea-to-a-rigorous-solution">6. Conclusion: From a Simple Idea to a Rigorous Solution</h2>
<p>Our investigation started with a simple and intuitive goal: to replace the Gaussian latent distribution in a VAE with a power-basis cubic polynomial. However, our rigorous mathematical analysis revealed that this “simple” idea is fraught with complexity. The non-negativity constraint imposes a set of intractable, non-linear conditions on the polynomial’s coefficients, making it unsuitable for direct parameterization by a neural network.</p>
<p>This journey highlights a critical lesson in theoretical deep learning: an approach’s utility is defined not by the simplicity of its initial form, but by the simplicity of its constraints and the ease of its integration into a gradient-based optimization pipeline.</p>
<p>The Bernstein basis, while appearing more complex at first glance, provides a far more elegant and practical solution. By building the non-negativity and normalization properties directly into the formulation, it allows us to define a flexible, bounded, and fully differentiable latent distribution. This demonstrates the power of choosing the right mathematical tools to turn a complex problem into a tractable one.</p>
<section id="antiderivatives-used-in-the-cdf" class="level4">
<h4 class="anchored" data-anchor-id="antiderivatives-used-in-the-cdf">Antiderivatives used in the CDF</h4>
<p>For completeness, the antiderivatives <span class="math inline">\(I_k(t)=\int_0^t B_k(u)\,du\)</span> are <span class="math display">\[
\begin{aligned}
I_0(t)&amp;=t-\tfrac{3}{2}t^2+t^3-\tfrac{1}{4}t^4,\\
I_1(t)&amp;=\tfrac{3}{2}t^2-2t^3+\tfrac{3}{4}t^4,\\
I_2(t)&amp;=t^3-\tfrac{3}{4}t^4,\\
I_3(t)&amp;=\tfrac{1}{4}t^4.
\end{aligned}
\]</span> Thus <span class="math inline">\(F(t;\mathbf{c})=\sum_{k=0}^3 c_k I_k(t)\)</span> and <span class="math inline">\(F'(t;\mathbf{c})=\sum_{k=0}^3 c_k B_k(t)\)</span>.</p>
<hr>
</section>
</section>
<section id="further-reading-beyond-simple-posteriors" class="level2">
<h2 class="anchored" data-anchor-id="further-reading-beyond-simple-posteriors">7. Further Reading: Beyond Simple Posteriors</h2>
<p>While our Bernstein-cubic VAE provides a flexible, bounded alternative to the Gaussian, the quest for more expressive posterior distributions is a rich area of research. Here are some of the most effective methods for moving beyond simple unimodal posteriors:</p>
<section id="normalizing-flows" class="level3">
<h3 class="anchored" data-anchor-id="normalizing-flows">Normalizing Flows</h3>
<p>Normalizing flows are a powerful class of methods that transform a simple base distribution (like a Gaussian) into a much more complex one through a series of invertible, differentiable mappings.</p>
<ul>
<li><strong>Foundational Idea</strong>: <a href="https://arxiv.org/abs/1505.05770">Variational Inference with Normalizing Flows</a> (Rezende &amp; Mohamed, 2015) introduces planar and radial flows.</li>
<li><strong>Inverse Autoregressive Flow (IAF)</strong>: A highly effective and popular choice for VAEs due to its fast sampling. <a href="https://arxiv.org/abs/1606.04934">Improved VI with IAF</a> (Kingma et al., 2016).</li>
<li><strong>Coupling and Autoregressive Flows</strong>: These offer great stability and capacity.
<ul>
<li><a href="https://arxiv.org/abs/1605.08803">RealNVP</a> (Dinh et al., 2017)</li>
<li><a href="https://arxiv.org/abs/1705.07057">Masked Autoregressive Flow (MAF)</a> (Papamakarios et al., 2017)</li>
<li><a href="https://arxiv.org/abs/1807.03039">Glow</a> (Kingma &amp; Dhariwal, 2018)</li>
</ul></li>
<li><strong>Spline Flows</strong>: Use monotonic splines for a great trade-off between flexibility and stability. Excellent for bounded supports. <a href="https://arxiv.org/abs/1906.04032">Neural Spline Flows</a> (Durkan et al., 2019).</li>
<li><strong>Advanced Flows</strong>: For even greater expressivity.
<ul>
<li><a href="https://arxiv.org/abs/1803.05649">Sylvester Flows</a> (Berg et al., 2018)</li>
<li><a href="https://arxiv.org/abs/1611.09630">Householder Flow</a> (Tomczak &amp; Welling, 2016)</li>
</ul></li>
</ul>
</section>
<section id="mixture-models-and-hierarchical-methods" class="level3">
<h3 class="anchored" data-anchor-id="mixture-models-and-hierarchical-methods">Mixture Models and Hierarchical Methods</h3>
<p>These approaches directly model multimodality or enrich the posterior through a hierarchical structure.</p>
<ul>
<li><strong>Mixture Posteriors</strong>: Use a mixture of simple distributions (e.g., Gaussians) to form a complex posterior.
<ul>
<li><a href="https://arxiv.org/abs/1611.05559">Boosting VI</a> (Guo et al., 2016)</li>
<li><a href="https://arxiv.org/abs/1611.06585">Variational Boosting</a> (Miller et al., 2017)</li>
</ul></li>
<li><strong>Semi-Implicit Variational Inference (SIVI)</strong>: Captures complex posteriors by mixing an explicit distribution with an implicit one. <a href="https://arxiv.org/abs/1805.11142">SIVI</a> (Yin &amp; Zhou, 2018).</li>
<li><strong>Hierarchical/Auxiliary Posteriors</strong>: Introduce auxiliary latent variables to create a richer posterior structure.
<ul>
<li><a href="https://arxiv.org/abs/1602.05473">Auxiliary Deep Generative Models</a> (Maaløe et al., 2016)</li>
<li><a href="https://arxiv.org/abs/1602.02282">Ladder VAE</a> (Sønderby et al., 2016)</li>
<li><a href="https://arxiv.org/abs/1602.06725">Hierarchical Variational Models</a> (Ranganath et al., 2016)</li>
</ul></li>
</ul>
</section>
<section id="alternative-objectives-and-formulations" class="level3">
<h3 class="anchored" data-anchor-id="alternative-objectives-and-formulations">Alternative Objectives and Formulations</h3>
<ul>
<li><strong>Implicit Posteriors</strong>: Use adversarial training to learn an implicit posterior without a closed-form density. <a href="https://arxiv.org/abs/1701.04722">Adversarial Variational Bayes</a> (Mescheder et al., 2017).</li>
<li><strong>Tighter Evidence Bounds</strong>: Improve training by using a tighter lower bound on the evidence, which often leads to learning a better posterior. The canonical example is the <strong>Importance Weighted Autoencoder (IWAE)</strong>. <a href="https://arxiv.org/abs/1509.00519">IWAE</a> (Burda et al., 2016).</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gSW1wb3J0IEQzIGZvciBhbmltYXRpb25zXG5kMyA9IHJlcXVpcmUoXCJkM0A3XCIpXG5cbi8vIENyZWF0ZSB0aGUgY29tcHJlaGVuc2l2ZSBWQUUgdmlzdWFsaXphdGlvblxue1xuICBjb25zdCB3aWR0aCA9IDg1MDtcbiAgY29uc3QgaGVpZ2h0ID0gNDgwO1xuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG4gICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImZsZXhcIilcbiAgICAuc3R5bGUoXCJqdXN0aWZ5LWNvbnRlbnRcIiwgXCJjZW50ZXJcIilcbiAgICAuc3R5bGUoXCJhbGlnbi1pdGVtc1wiLCBcImNlbnRlclwiKVxuICAgIC5zdHlsZShcIndpZHRoXCIsIFwiMTAwJVwiKVxuICAgIC5zdHlsZShcIm1hcmdpblwiLCBcIjIwcHggYXV0b1wiKTtcbiAgXG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgYDAgMCAke3dpZHRofSAke2hlaWdodH1gKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBcIjEwMCVcIilcbiAgICAuc3R5bGUoXCJoZWlnaHRcIiwgXCJhdXRvXCIpXG4gICAgLnN0eWxlKFwiYmFja2dyb3VuZFwiLCBcImxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSlcIilcbiAgICAuc3R5bGUoXCJib3JkZXItcmFkaXVzXCIsIFwiMTJweFwiKVxuICAgIC5zdHlsZShcImJveC1zaGFkb3dcIiwgXCIwIDEwcHggMzBweCByZ2JhKDAsMCwwLDAuMilcIik7XG4gIFxuICAvLyBBZGQgZ3JhZGllbnQgZGVmaW5pdGlvbnNcbiAgY29uc3QgZGVmcyA9IHN2Zy5hcHBlbmQoXCJkZWZzXCIpO1xuICBcbiAgLy8gQmFja2dyb3VuZCBncmFkaWVudFxuICBjb25zdCBiZ0dyYWRpZW50ID0gZGVmcy5hcHBlbmQoXCJsaW5lYXJHcmFkaWVudFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJiZy1ncmFkaWVudFwiKVxuICAgIC5hdHRyKFwieDFcIiwgXCIwJVwiKS5hdHRyKFwieTFcIiwgXCIwJVwiKVxuICAgIC5hdHRyKFwieDJcIiwgXCIxMDAlXCIpLmF0dHIoXCJ5MlwiLCBcIjEwMCVcIik7XG4gIFxuICBiZ0dyYWRpZW50LmFwcGVuZChcInN0b3BcIilcbiAgICAuYXR0cihcIm9mZnNldFwiLCBcIjAlXCIpXG4gICAgLnN0eWxlKFwic3RvcC1jb2xvclwiLCBcIiMxZTNjNzJcIilcbiAgICAuc3R5bGUoXCJzdG9wLW9wYWNpdHlcIiwgMC45KTtcbiAgXG4gIGJnR3JhZGllbnQuYXBwZW5kKFwic3RvcFwiKVxuICAgIC5hdHRyKFwib2Zmc2V0XCIsIFwiMTAwJVwiKVxuICAgIC5zdHlsZShcInN0b3AtY29sb3JcIiwgXCIjMmE1Mjk4XCIpXG4gICAgLnN0eWxlKFwic3RvcC1vcGFjaXR5XCIsIDAuOSk7XG4gIFxuICAvLyBBcHBseSBncmFkaWVudCBiYWNrZ3JvdW5kXG4gIHN2Zy5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwidXJsKCNiZy1ncmFkaWVudClcIik7XG4gIFxuICAvLyBUaXRsZSB3aXRoIGdsb3cgZWZmZWN0XG4gIGNvbnN0IHRpdGxlID0gc3ZnLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgd2lkdGggLyAyKVxuICAgIC5hdHRyKFwieVwiLCAzMClcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMjJweFwiKVxuICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJ3aGl0ZVwiKVxuICAgIC5zdHlsZShcImZpbHRlclwiLCBcImRyb3Atc2hhZG93KDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMykpXCIpXG4gICAgLnRleHQoXCJWYXJpYXRpb25hbCBBdXRvZW5jb2RlciAoVkFFKSBBcmNoaXRlY3R1cmVcIik7XG4gIFxuICAvLyBEZWZpbmUgcG9zaXRpb25zXG4gIGNvbnN0IGlucHV0WCA9IHdpZHRoICogMC4xO1xuICBjb25zdCBlbmNvZGVyWCA9IHdpZHRoICogMC4yNTtcbiAgY29uc3QgbXVTaWdtYVggPSB3aWR0aCAqIDAuNDtcbiAgY29uc3QgbGF0ZW50WCA9IHdpZHRoICogMC41NTtcbiAgY29uc3QgZGVjb2RlclggPSB3aWR0aCAqIDAuNztcbiAgY29uc3Qgb3V0cHV0WCA9IHdpZHRoICogMC44NTtcbiAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7XG4gIFxuICAvLyBDcmVhdGUgbmV1cmFsIG5ldHdvcmsgdmlzdWFsaXphdGlvbiBmb3IgZW5jb2RlclxuICBjb25zdCBlbmNvZGVyR3JvdXAgPSBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgXG4gIC8vIERyYXcgZW5jb2RlciBsYXllcnNcbiAgY29uc3QgZW5jb2RlckxheWVycyA9IFs0LCAzLCAyXTtcbiAgZW5jb2RlckxheWVycy5mb3JFYWNoKChuZXVyb25zLCBsYXllcklkeCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV1cm9uczsgaSsrKSB7XG4gICAgICBjb25zdCB5ID0gY2VudGVyWSAtIChuZXVyb25zIC0gMSkgKiAxNSArIGkgKiAzMDtcbiAgICAgIGVuY29kZXJHcm91cC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgICAgLmF0dHIoXCJjeFwiLCBlbmNvZGVyWCArIGxheWVySWR4ICogMjUpXG4gICAgICAgIC5hdHRyKFwiY3lcIiwgeSlcbiAgICAgICAgLmF0dHIoXCJyXCIsIDYpXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiM0RkMzRjdcIilcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJ3aGl0ZVwiKVxuICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxLjUpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBlbmNvZGVyR3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCBlbmNvZGVyWCArIDI1KVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZICsgNjApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjEycHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwid2hpdGVcIilcbiAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcIjUwMFwiKVxuICAgIC50ZXh0KFwiRW5jb2RlciBOZXR3b3JrXCIpO1xuICBcbiAgLy8gQ3JlYXRlIGlucHV0IGRhdGEgdmlzdWFsaXphdGlvbiAoYXMgaW1hZ2UgZ3JpZClcbiAgY29uc3QgaW5wdXRHcm91cCA9IHN2Zy5hcHBlbmQoXCJnXCIpO1xuICBjb25zdCBncmlkU2l6ZSA9IDU7XG4gIGNvbnN0IGNlbGxTaXplID0gODtcbiAgXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JpZFNpemU7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgZ3JpZFNpemU7IGorKykge1xuICAgICAgaW5wdXRHcm91cC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwieFwiLCBpbnB1dFggLSBncmlkU2l6ZSAqIGNlbGxTaXplIC8gMiArIGkgKiBjZWxsU2l6ZSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgLSBncmlkU2l6ZSAqIGNlbGxTaXplIC8gMiArIGogKiBjZWxsU2l6ZSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBjZWxsU2l6ZSAtIDEpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGNlbGxTaXplIC0gMSlcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGBoc2woJHtNYXRoLnJhbmRvbSgpICogNjAgKyAyMDB9LCA3MCUsICR7NTAgKyBNYXRoLnJhbmRvbSgpICogMzB9JSlgKVxuICAgICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMC45KTtcbiAgICB9XG4gIH1cbiAgXG4gIGlucHV0R3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCBpbnB1dFgpXG4gICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgKyA2MClcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTJweFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJ3aGl0ZVwiKVxuICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiNTAwXCIpXG4gICAgLnRleHQoXCJJbnB1dCBEYXRhXCIpO1xuICBcbiAgLy8gTWVhbiBhbmQgVmFyaWFuY2UgdmlzdWFsaXphdGlvblxuICBjb25zdCBtdVNpZ21hR3JvdXAgPSBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgXG4gIC8vIE1lYW4gKM68KVxuICBtdVNpZ21hR3JvdXAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgLmF0dHIoXCJjeFwiLCBtdVNpZ21hWClcbiAgICAuYXR0cihcImN5XCIsIGNlbnRlclkgLSAyNSlcbiAgICAuYXR0cihcInJcIiwgMTIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwiI0ZGRDU0RlwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAyKTtcbiAgXG4gIG11U2lnbWFHcm91cC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIG11U2lnbWFYKVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZIC0gMjEpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjE0cHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzMzM1wiKVxuICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgIC50ZXh0KFwizrxcIik7XG4gIFxuICAvLyBWYXJpYW5jZSAoz4MpXG4gIG11U2lnbWFHcm91cC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAuYXR0cihcImN4XCIsIG11U2lnbWFYKVxuICAgIC5hdHRyKFwiY3lcIiwgY2VudGVyWSArIDI1KVxuICAgIC5hdHRyKFwiclwiLCAxMilcbiAgICAuYXR0cihcImZpbGxcIiwgXCIjODFDNzg0XCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJ3aGl0ZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDIpO1xuICBcbiAgbXVTaWdtYUdyb3VwLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgbXVTaWdtYVgpXG4gICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgKyAyOSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTRweFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMzMzXCIpXG4gICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpXG4gICAgLnRleHQoXCLPg1wiKTtcbiAgXG4gIG11U2lnbWFHcm91cC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIG11U2lnbWFYKVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZICsgNzApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjExcHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwid2hpdGVcIilcbiAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcIjUwMFwiKVxuICAgIC50ZXh0KFwiUGFyYW1ldGVyc1wiKTtcbiAgXG4gIC8vIExhdGVudCBzcGFjZSB2aXN1YWxpemF0aW9uIHdpdGggbWl4dHVyZSBvZiBHYXVzc2lhbnNcbiAgY29uc3QgbGF0ZW50R3JvdXAgPSBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgXG4gIC8vIERyYXcgbXVsdGlwbGUgR2F1c3NpYW4gZGlzdHJpYnV0aW9ucyBmb3IgbWl4dHVyZVxuICBjb25zdCBnYXVzc2lhbkNlbnRlcnMgPSBbXG4gICAge3g6IGxhdGVudFggLSAyNSwgeTogY2VudGVyWSAtIDE1LCBjb2xvcjogXCIjRTFCRUU3XCJ9LFxuICAgIHt4OiBsYXRlbnRYICsgMjAsIHk6IGNlbnRlclkgLSAxMCwgY29sb3I6IFwiI0M1Q0FFOVwifSxcbiAgICB7eDogbGF0ZW50WCwgeTogY2VudGVyWSArIDE1LCBjb2xvcjogXCIjRDFDNEU5XCJ9XG4gIF07XG4gIFxuICAvLyBEcmF3IGNvbnRvdXJzIGZvciBlYWNoIEdhdXNzaWFuIGluIHRoZSBtaXh0dXJlXG4gIGdhdXNzaWFuQ2VudGVycy5mb3JFYWNoKChjZW50ZXIsIGdJZHgpID0+IHtcbiAgICBjb25zdCByYWRpaSA9IFszMCwgMjIsIDE0XTtcbiAgICByYWRpaS5mb3JFYWNoKChyYWRpdXMsIGlkeCkgPT4ge1xuICAgICAgbGF0ZW50R3JvdXAuYXBwZW5kKFwiZWxsaXBzZVwiKVxuICAgICAgICAuYXR0cihcImN4XCIsIGNlbnRlci54KVxuICAgICAgICAuYXR0cihcImN5XCIsIGNlbnRlci55KVxuICAgICAgICAuYXR0cihcInJ4XCIsIHJhZGl1cylcbiAgICAgICAgLmF0dHIoXCJyeVwiLCByYWRpdXMgKiAwLjg1KVxuICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNlbnRlci5jb2xvcilcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgICAgICAgLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIGlkeCA9PT0gMCA/IFwiMiwyXCIgOiBcIm5vbmVcIilcbiAgICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDAuNSAtIGlkeCAqIDAuMTIpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIC8vIFNhbXBsZWQgcG9pbnRzIGZyb20gbWl4dHVyZVxuICBjb25zdCBzYW1wbGVkUG9pbnRzID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgY29uc3QgcG9pbnQgPSBsYXRlbnRHcm91cC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgIC5hdHRyKFwiY3hcIiwgbGF0ZW50WClcbiAgICAgIC5hdHRyKFwiY3lcIiwgY2VudGVyWSlcbiAgICAgIC5hdHRyKFwiclwiLCAzKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiI0ZGNkI2QlwiKVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJ3aGl0ZVwiKVxuICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgICBzYW1wbGVkUG9pbnRzLnB1c2gocG9pbnQpO1xuICB9XG4gIFxuICAvLyBSZXBhcmFtZXRlcml6YXRpb24gdHJpY2sgdmlzdWFsaXphdGlvbiB3aXRoIHByb3BlciBtYXRoXG4gIGNvbnN0IHJlcGFyYW1Hcm91cCA9IGxhdGVudEdyb3VwLmFwcGVuZChcImdcIik7XG4gIFxuICAvLyBDcmVhdGUgd2hpdGUgYmFja2dyb3VuZCBmb3IgZm9ybXVsYVxuICByZXBhcmFtR3JvdXAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCBsYXRlbnRYIC0gNDUpXG4gICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgLSA2NSlcbiAgICAuYXR0cihcIndpZHRoXCIsIDkwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDI4KVxuICAgIC5hdHRyKFwicnhcIiwgNClcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuOTUpXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuMylcIilcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxKTtcbiAgXG4gIC8vIE1haW4gZm9ybXVsYVxuICByZXBhcmFtR3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCBsYXRlbnRYKVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZIC0gNTApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjExcHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzFlM2M3MlwiKVxuICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiNjAwXCIpXG4gICAgLnN0eWxlKFwiZm9udC1mYW1pbHlcIiwgXCJzZXJpZlwiKVxuICAgIC5zdHlsZShcImZvbnQtc3R5bGVcIiwgXCJpdGFsaWNcIilcbiAgICAudGV4dChcInogPSDOvCArIM+DIOKKmSDOtVwiKTtcbiAgXG4gIC8vIERpc3RyaWJ1dGlvbiBub3RhdGlvblxuICByZXBhcmFtR3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCBsYXRlbnRYKVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZIC0gNzUpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjlweFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCIjRkZFQ0IzXCIpXG4gICAgLnN0eWxlKFwiZm9udC1mYW1pbHlcIiwgXCJzZXJpZlwiKVxuICAgIC5zdHlsZShcImZvbnQtc3R5bGVcIiwgXCJpdGFsaWNcIilcbiAgICAudGV4dChcIs61IH4g8J2SqSgwLEkpXCIpO1xuICBcbiAgbGF0ZW50R3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCBsYXRlbnRYKVxuICAgIC5hdHRyKFwieVwiLCBjZW50ZXJZICsgNzApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjEycHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwid2hpdGVcIilcbiAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcIjUwMFwiKVxuICAgIC50ZXh0KFwiTGF0ZW50IFNwYWNlIChNaXh0dXJlKVwiKTtcbiAgXG4gIC8vIEFkZCBsYWJlbCBmb3IgbWl4dHVyZVxuICBsYXRlbnRHcm91cC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIGxhdGVudFgpXG4gICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgKyA4NSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiOXB4XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNFMUJFRTdcIilcbiAgICAuc3R5bGUoXCJmb250LWZhbWlseVwiLCBcInNlcmlmXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zdHlsZVwiLCBcIml0YWxpY1wiKVxuICAgIC50ZXh0KFwicSh6KSA9IM6j4bWiIM+A4bWiIPCdkqkozrzhtaIsIM+D4bWiwrIpXCIpO1xuICBcbiAgLy8gRGVjb2RlciBuZXR3b3JrXG4gIGNvbnN0IGRlY29kZXJHcm91cCA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICBcbiAgLy8gRHJhdyBkZWNvZGVyIGxheWVycyAobWlycm9yIG9mIGVuY29kZXIpXG4gIGNvbnN0IGRlY29kZXJMYXllcnMgPSBbMiwgMywgNF07XG4gIGRlY29kZXJMYXllcnMuZm9yRWFjaCgobmV1cm9ucywgbGF5ZXJJZHgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ldXJvbnM7IGkrKykge1xuICAgICAgY29uc3QgeSA9IGNlbnRlclkgLSAobmV1cm9ucyAtIDEpICogMTUgKyBpICogMzA7XG4gICAgICBkZWNvZGVyR3JvdXAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgIC5hdHRyKFwiY3hcIiwgZGVjb2RlclggKyBsYXllcklkeCAqIDI1KVxuICAgICAgICAuYXR0cihcImN5XCIsIHkpXG4gICAgICAgIC5hdHRyKFwiclwiLCA2KVxuICAgICAgICAuYXR0cihcImZpbGxcIiwgXCIjRkY3MDQzXCIpXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMS41KTtcbiAgICB9XG4gIH0pO1xuICBcbiAgZGVjb2Rlckdyb3VwLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgZGVjb2RlclggKyAyNSlcbiAgICAuYXR0cihcInlcIiwgY2VudGVyWSArIDYwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIxMnB4XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIndoaXRlXCIpXG4gICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCI1MDBcIilcbiAgICAudGV4dChcIkRlY29kZXIgTmV0d29ya1wiKTtcbiAgXG4gIC8vIE91dHB1dC9yZWNvbnN0cnVjdGlvbiB2aXN1YWxpemF0aW9uXG4gIGNvbnN0IG91dHB1dEdyb3VwID0gc3ZnLmFwcGVuZChcImdcIikuYXR0cihcIm9wYWNpdHlcIiwgMCk7XG4gIFxuICBmb3IgKGxldCBpID0gMDsgaSA8IGdyaWRTaXplOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGdyaWRTaXplOyBqKyspIHtcbiAgICAgIG91dHB1dEdyb3VwLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIG91dHB1dFggLSBncmlkU2l6ZSAqIGNlbGxTaXplIC8gMiArIGkgKiBjZWxsU2l6ZSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIGNlbnRlclkgLSBncmlkU2l6ZSAqIGNlbGxTaXplIC8gMiArIGogKiBjZWxsU2l6ZSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBjZWxsU2l6ZSAtIDEpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGNlbGxTaXplIC0gMSlcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGBoc2woJHtNYXRoLnJhbmRvbSgpICogNjAgKyAyMDB9LCA2MCUsICR7NDUgKyBNYXRoLnJhbmRvbSgpICogMjV9JSlgKVxuICAgICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMC44KTtcbiAgICB9XG4gIH1cbiAgXG4gIG91dHB1dEdyb3VwLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgb3V0cHV0WClcbiAgICAuYXR0cihcInlcIiwgY2VudGVyWSArIDYwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIxMnB4XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIndoaXRlXCIpXG4gICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCI1MDBcIilcbiAgICAudGV4dChcIlJlY29uc3RydWN0aW9uXCIpO1xuICBcbiAgLy8gTG9zcyB2aXN1YWxpemF0aW9uXG4gIGNvbnN0IGxvc3NHcm91cCA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICBcbiAgbG9zc0dyb3VwLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInhcIiwgd2lkdGggLyAyIC0gMTAwKVxuICAgIC5hdHRyKFwieVwiLCBoZWlnaHQgLSA5MClcbiAgICAuYXR0cihcIndpZHRoXCIsIDIwMClcbiAgICAuYXR0cihcImhlaWdodFwiLCA1MClcbiAgICAuYXR0cihcInJ4XCIsIDgpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmdiYSgyNTUsMjU1LDI1NSwwLjEpXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuMylcIilcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxKTtcbiAgXG4gIGxvc3NHcm91cC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIHdpZHRoIC8gMilcbiAgICAuYXR0cihcInlcIiwgaGVpZ2h0IC0gNjUpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjExcHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI0ZGRjlDNFwiKVxuICAgIC5zdHlsZShcImZvbnQtZmFtaWx5XCIsIFwic2VyaWZcIilcbiAgICAuc3R5bGUoXCJmb250LXN0eWxlXCIsIFwiaXRhbGljXCIpXG4gICAgLnRleHQoXCLihJIgPSDihJJyZWNvbiArIOKEkktMXCIpO1xuICBcbiAgbG9zc0dyb3VwLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgd2lkdGggLyAyIC0gNTApXG4gICAgLmF0dHIoXCJ5XCIsIGhlaWdodCAtIDQ4KVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIxMHB4XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNGRkNERDJcIilcbiAgICAuc3R5bGUoXCJmb250LWZhbWlseVwiLCBcInNlcmlmXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zdHlsZVwiLCBcIml0YWxpY1wiKVxuICAgIC50ZXh0KFwi4oCWeCDiiJIgeMyC4oCWwrJcIik7XG4gIFxuICBsb3NzR3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCB3aWR0aCAvIDIgKyA1MClcbiAgICAuYXR0cihcInlcIiwgaGVpZ2h0IC0gNDgpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjEwcHhcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI0M1RTFBNVwiKVxuICAgIC5zdHlsZShcImZvbnQtZmFtaWx5XCIsIFwic2VyaWZcIilcbiAgICAuc3R5bGUoXCJmb250LXN0eWxlXCIsIFwiaXRhbGljXCIpXG4gICAgLnRleHQoXCLwnZKfS0woceKAlnApXCIpO1xuICBcbiAgLy8gQ29ubmVjdGlvbiBsaW5lc1xuICBjb25zdCBjb25uZWN0aW9ucyA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICBcbiAgLy8gRGVmaW5lIGFycm93IG1hcmtlcnNcbiAgZGVmcy5hcHBlbmQoXCJtYXJrZXJcIilcbiAgICAuYXR0cihcImlkXCIsIFwiYXJyb3ctd2hpdGVcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgXCIwIDAgMTAgMTBcIilcbiAgICAuYXR0cihcInJlZlhcIiwgMTApXG4gICAgLmF0dHIoXCJyZWZZXCIsIDUpXG4gICAgLmF0dHIoXCJtYXJrZXJXaWR0aFwiLCA2KVxuICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDYpXG4gICAgLmF0dHIoXCJvcmllbnRcIiwgXCJhdXRvXCIpXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgXCJNIDAgMCBMIDEwIDUgTCAwIDEwIHpcIilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuOClcIik7XG4gIFxuICAvLyBDb25uZWN0aW9uIHBhdGhzXG4gIGNvbnN0IHBhdGhEYXRhID0gW1xuICAgIHt4MTogaW5wdXRYICsgMjUsIHkxOiBjZW50ZXJZLCB4MjogZW5jb2RlclggLSAxMCwgeTI6IGNlbnRlcll9LFxuICAgIHt4MTogZW5jb2RlclggKyA2MCwgeTE6IGNlbnRlclksIHgyOiBtdVNpZ21hWCAtIDE1LCB5MjogY2VudGVyWX0sXG4gICAge3gxOiBtdVNpZ21hWCArIDE1LCB5MTogY2VudGVyWSwgeDI6IGxhdGVudFggLSA1MCwgeTI6IGNlbnRlcll9LFxuICAgIHt4MTogbGF0ZW50WCArIDUwLCB5MTogY2VudGVyWSwgeDI6IGRlY29kZXJYIC0gMTAsIHkyOiBjZW50ZXJZfSxcbiAgICB7eDE6IGRlY29kZXJYICsgNjAsIHkxOiBjZW50ZXJZLCB4Mjogb3V0cHV0WCAtIDI1LCB5MjogY2VudGVyWX1cbiAgXTtcbiAgXG4gIHBhdGhEYXRhLmZvckVhY2goZCA9PiB7XG4gICAgY29ubmVjdGlvbnMuYXBwZW5kKFwibGluZVwiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCBkLngxKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBkLnkxKVxuICAgICAgLmF0dHIoXCJ4MlwiLCBkLngyKVxuICAgICAgLmF0dHIoXCJ5MlwiLCBkLnkyKVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuNClcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDIpXG4gICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgXCJ1cmwoI2Fycm93LXdoaXRlKVwiKTtcbiAgfSk7XG4gIFxuICAvLyBQbGF5IGJ1dHRvblxuICBjb25zdCBidXR0b24gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt3aWR0aC8yIC0gNjB9LCA2MClgKTtcbiAgXG4gIGJ1dHRvbi5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCAxMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMzUpXG4gICAgLmF0dHIoXCJyeFwiLCAxOClcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDI1NSwyNTUsMjU1LDAuOSlcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcIndoaXRlXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMilcbiAgICAuc3R5bGUoXCJmaWx0ZXJcIiwgXCJkcm9wLXNoYWRvdygwIDRweCA2cHggcmdiYSgwLDAsMCwwLjIpKVwiKTtcbiAgXG4gIGJ1dHRvbi5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDYwKVxuICAgIC5hdHRyKFwieVwiLCAyMilcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTRweFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMWUzYzcyXCIpXG4gICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpXG4gICAgLnRleHQoXCLilrYgUGxheVwiKTtcbiAgXG4gIC8vIEFuaW1hdGlvbiBmdW5jdGlvblxuICBmdW5jdGlvbiBydW5BbmltYXRpb24oKSB7XG4gICAgLy8gUmVzZXQgZXZlcnl0aGluZ1xuICAgIGVuY29kZXJHcm91cC5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgICBtdVNpZ21hR3JvdXAuYXR0cihcIm9wYWNpdHlcIiwgMCk7XG4gICAgbGF0ZW50R3JvdXAuYXR0cihcIm9wYWNpdHlcIiwgMCk7XG4gICAgZGVjb2Rlckdyb3VwLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICAgIG91dHB1dEdyb3VwLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICAgIGxvc3NHcm91cC5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgICBjb25uZWN0aW9ucy5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgICBcbiAgICAvLyBQaGFzZSAxOiBTaG93IGVuY29kZXIgbmV0d29ya1xuICAgIGVuY29kZXJHcm91cFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmRlbGF5KDUwMClcbiAgICAgIC5kdXJhdGlvbig4MDApXG4gICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMSk7XG4gICAgXG4gICAgY29ubmVjdGlvbnNcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kZWxheSg1MDApXG4gICAgICAuZHVyYXRpb24oODAwKVxuICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDEpO1xuICAgIFxuICAgIC8vIFBoYXNlIDI6IFNob3cgzrwgYW5kIM+DXG4gICAgbXVTaWdtYUdyb3VwXG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZGVsYXkoMTUwMClcbiAgICAgIC5kdXJhdGlvbig4MDApXG4gICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMSk7XG4gICAgXG4gICAgLy8gUGhhc2UgMzogU2hvdyBsYXRlbnQgc3BhY2Ugd2l0aCBzYW1wbGluZyBhbmltYXRpb25cbiAgICBsYXRlbnRHcm91cFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmRlbGF5KDI1MDApXG4gICAgICAuZHVyYXRpb24oODAwKVxuICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDEpO1xuICAgIFxuICAgIC8vIEFuaW1hdGUgc2FtcGxpbmcgcG9pbnRzIGZyb20gbWl4dHVyZVxuICAgIHNhbXBsZWRQb2ludHMuZm9yRWFjaCgocG9pbnQsIGlkeCkgPT4ge1xuICAgICAgY29uc3QgZ2F1c3NpYW4gPSBnYXVzc2lhbkNlbnRlcnNbaWR4ICUgM107XG4gICAgICBwb2ludFxuICAgICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMClcbiAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAuZGVsYXkoMzMwMCArIGlkeCAqIDEwMClcbiAgICAgICAgLmR1cmF0aW9uKDMwMClcbiAgICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDAuOSlcbiAgICAgICAgLmF0dHIoXCJjeFwiLCBnYXVzc2lhbi54ICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMjApXG4gICAgICAgIC5hdHRyKFwiY3lcIiwgZ2F1c3NpYW4ueSArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDE4KVxuICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgIC5kdXJhdGlvbig0MDApXG4gICAgICAgIC5hdHRyKFwiclwiLCA0KVxuICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgIC5kdXJhdGlvbigzMDApXG4gICAgICAgIC5hdHRyKFwiclwiLCAzKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBQaGFzZSA0OiBTaG93IGRlY29kZXJcbiAgICBkZWNvZGVyR3JvdXBcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kZWxheSg0MDAwKVxuICAgICAgLmR1cmF0aW9uKDgwMClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAxKTtcbiAgICBcbiAgICAvLyBQaGFzZSA1OiBTaG93IHJlY29uc3RydWN0aW9uXG4gICAgb3V0cHV0R3JvdXBcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kZWxheSg1MDAwKVxuICAgICAgLmR1cmF0aW9uKDgwMClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAxKTtcbiAgICBcbiAgICAvLyBQaGFzZSA2OiBTaG93IGxvc3NcbiAgICBsb3NzR3JvdXBcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kZWxheSg2MDAwKVxuICAgICAgLmR1cmF0aW9uKDgwMClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAxKTtcbiAgfVxuICBcbiAgLy8gQWRkIGNsaWNrIGhhbmRsZXJcbiAgYnV0dG9uLm9uKFwiY2xpY2tcIiwgcnVuQW5pbWF0aW9uKTtcbiAgXG4gIC8vIEF1dG8tcnVuIGFuaW1hdGlvbiBvbiBsb2FkXG4gIHNldFRpbWVvdXQocnVuQW5pbWF0aW9uLCA4MDApO1xuICBcbiAgeWllbGQgY29udGFpbmVyLm5vZGUoKTtcbn1cblxubWRgXG4qKlRoaXMgYW5pbWF0aW9uIGlsbHVzdHJhdGVzIHRoZSBjb21wbGV0ZSBWQUUgcHJvY2VzczoqKlxuXG4xLiAqKvCfk6UgRW5jb2RpbmcqKjogSW5wdXQgZGF0YSAoc2hvd24gYXMgcGl4ZWwgZ3JpZCkgaXMgcHJvY2Vzc2VkIHRocm91Z2ggdGhlIGVuY29kZXIgbmV1cmFsIG5ldHdvcmtcbjIuICoq8J+TiiBQYXJhbWV0ZXJzKio6IFRoZSBlbmNvZGVyIG91dHB1dHMgbWVhbiAozrwpIGFuZCB2YXJpYW5jZSAoz4MpIHBhcmFtZXRlcnNcbjMuICoq8J+OsiBSZXBhcmFtZXRlcml6YXRpb24qKjogVXNpbmcgdGhlIGZvcm11bGEgeiA9IM68ICsgz4Mg4oqZIM61IHdoZXJlIM61IH4g8J2SqSgwLEkpXG40LiAqKvCfjJAgTGF0ZW50IFNwYWNlKio6IFNob3dzIGEgbWl4dHVyZSBvZiBHYXVzc2lhbnMgZGlzdHJpYnV0aW9uIHdpdGggbXVsdGlwbGUgbW9kZXNcbjUuICoq8J+TpCBEZWNvZGluZyoqOiBTYW1wbGVkIHBvaW50cyBhcmUgZGVjb2RlZCB0aHJvdWdoIHRoZSBkZWNvZGVyIG5ldHdvcmtcbjYuICoq8J+WvO+4jyBSZWNvbnN0cnVjdGlvbioqOiBPdXRwdXQgYXR0ZW1wdHMgdG8gcmVjb25zdHJ1Y3QgdGhlIG9yaWdpbmFsIGlucHV0XG43LiAqKvCfk4kgTG9zcyBGdW5jdGlvbioqOiDihJIgPSDihJJyZWNvbiArIOKEkktMIGJhbGFuY2VzIHJlY29uc3RydWN0aW9uIHF1YWxpdHkgd2l0aCByZWd1bGFyaXphdGlvblxuXG5UaGUgdmlzdWFsaXphdGlvbiBkZW1vbnN0cmF0ZXMgaG93IFZBRXMgY2FuIGxlYXJuIGNvbXBsZXgsIG11bHRpbW9kYWwgbGF0ZW50IGRpc3RyaWJ1dGlvbnMgd2hpbGUgbWFpbnRhaW5pbmcgZGlmZmVyZW50aWFiaWxpdHkgdGhyb3VnaCB0aGUgcmVwYXJhbWV0ZXJpemF0aW9uIHRyaWNrLlxuXG4qQ2xpY2sgXCLilrYgUGxheVwiIHRvIHJlcGxheSB0aGUgYW5pbWF0aW9uLipcbmBcbiJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/vae-experiments";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kaivalya1997\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="Kaivalya1997/blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright © Kaivalya Dabhadkar</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>